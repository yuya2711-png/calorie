<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—æ©Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }

    input, select, button {
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      margin: 5px 0;
    }

    .food-row {
      display: grid;
      grid-template-columns: 1.4fr 1fr 0.8fr 0.6fr;
      gap: 6px;
      margin-bottom: 10px;
      align-items: center;
    }

    .search-box {
      grid-column: 1 / -1;
    }

    .cal-display {
      background: #eee;
      text-align: right;
    }

    .delete-btn {
      background: #ff6666;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }

    .custom-food {
      display: none;
      background: #f0f8ff;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
    }

    .result {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }

    /* ğŸ“± ã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-width: 600px) {
      .food-row {
        grid-template-columns: 1fr;
      }

      input, select, button {
        height: 44px;
      }
    }
  </style>
</head>

<body>
<div class="container">
  <h2>ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—æ©Ÿ</h2>

  <label>ä¸€å›ã®ç·ã‚«ãƒ­ãƒªãƒ¼</label>
  <input type="number" id="totalCalories" value="150">

  <h3>é£Ÿäº‹å†…å®¹</h3>
  <div id="foods"></div>

  <!-- âœ… type="button" ã‚’å¿…ãšæŒ‡å®š -->
  <button type="button" onclick="addFood()">ï¼‹ é£Ÿæã‚’è¿½åŠ </button>
  <button type="button" onclick="toggleCustomFood()">
    é£ŸæãŒãƒªã‚¹ãƒˆã«ãªã„å ´åˆã¯ã“ã¡ã‚‰
  </button>

  <div class="custom-food" id="customFoodArea">
    <h3>é£Ÿæã‚’è¿½åŠ </h3>
    <input type="text" id="customName" placeholder="é£Ÿæå">
    <input type="number" id="customCal" placeholder="1gã‚ãŸã‚Šã®ã‚«ãƒ­ãƒªãƒ¼" step="0.01">
    <button type="button" onclick="addCustomFood()">ã“ã®é£Ÿæã‚’è¿½åŠ </button>
  </div>

  <button type="button" onclick="calculate()">è¨ˆç®—</button>

  <div class="result">
    æ®‹ã‚Šã‚«ãƒ­ãƒªãƒ¼ï¼š<span id="result">0</span> kcal
  </div>
</div>

<!-- é£Ÿæãƒ‡ãƒ¼ã‚¿ -->
<script src="foods.js"></script>

<script>
  let foodMaster =
    JSON.parse(localStorage.getItem("foodMaster")) || { ...defaultFoods };

  addFood();

  function addFood() {
    const foodsDiv = document.getElementById("foods");
    const row = document.createElement("div");
    row.className = "food-row";

    const search = document.createElement("input");
    search.type = "text";
    search.placeholder = "é£Ÿææ¤œç´¢";
    search.className = "search-box";

    const select = document.createElement("select");
    updateFoodOptions(select);

    const weight = document.createElement("input");
    weight.type = "number";
    weight.placeholder = "é‡(g)";

    const cal = document.createElement("input");
    cal.type = "number";
    cal.placeholder = "kcal";
    cal.className = "cal-display";
    cal.disabled = true;

    const del = document.createElement("button");
    del.type = "button"; // â† é‡è¦
    del.textContent = "Ã—";
    del.className = "delete-btn";
    del.onclick = () => row.remove();

    search.oninput = () => updateFoodOptions(select, search.value);

    weight.oninput = () => {
      const gram = Number(weight.value);
      cal.value = gram > 0
        ? Math.round(foodMaster[select.value] * gram)
        : "";
    };

    row.append(search, select, weight, cal, del);
    foodsDiv.appendChild(row);
  }

  function updateFoodOptions(select, keyword = "") {
    select.innerHTML = "";
    for (const food in foodMaster) {
      if (!food.includes(keyword)) continue;
      const option = document.createElement("option");
      option.value = food;
      option.textContent = food;
      select.appendChild(option);
    }
  }

  function toggleCustomFood() {
    const area = document.getElementById("customFoodArea");
    area.style.display = area.style.display === "none" ? "block" : "none";
  }

  function addCustomFood() {
    const name = document.getElementById("customName").value.trim();
    const cal = Number(document.getElementById("customCal").value);
    if (!name || cal <= 0) {
      alert("æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    foodMaster[name] = cal;
    localStorage.setItem("foodMaster", JSON.stringify(foodMaster));
    document.querySelectorAll("select")
      .forEach(s => updateFoodOptions(s));

    document.getElementById("customName").value = "";
    document.getElementById("customCal").value = "";
  }

  function calculate() {
    const total = Number(document.getElementById("totalCalories").value);
    let used = 0;
    document.querySelectorAll(".food-row").forEach(row => {
      used += Number(row.children[3].value || 0);
    });
    document.getElementById("result").textContent =
      Math.round(total - used);
  }
</script>
</body>
</html>
